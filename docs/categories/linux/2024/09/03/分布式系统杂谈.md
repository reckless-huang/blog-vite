---
title: 分布式系统杂谈
date: 2024-09-03 00:00:00
categories: [Linux]
tags: [分布式]
---
# 分布式系统杂谈
::: tip
分布式多么高大上的词汇,我也来了解一下:zap:   
这里的内容是我在学习分布式系统的过程中的一些杂谈,希望对你有所帮助。
:::
## 常见特征
- 数据分布（一致性哈希）
- 负载均衡
- 分布式事务
- 选主
- 分布式锁
### 一致性哈希 
普通的hash算法，当节点增加或者减少时，会导致大量的数据迁移，比如本来是10个节点，现在变成了11个节点，那么原来的数据就要重新计算hash值，然后迁移到新的节点上。这样的话，会导致大量的数据迁移，而且会导致大量的数据不命中缓存，从而导致缓存击穿。

一致性哈希算法通过先把服务节点主机名或者ip地址hash对2^32取模，然后再将取模后的值放到一个长度为2^32的数组中，这样就得到了一个环状的hash空间:cool:。然后将数据hash对2^32取模，然后顺时针找到第一个大于等于这个数据hash值的节点，就将数据存储到这个节点上。这样的话，当节点增加或者减少时，只会影响到这个节点附近的数据，而不会影响到整个数据集:cool:。这样就解决了数据迁移的问题。

但是一致性hash还是存在数据偏移的问题，因为hash算法是一个均匀分布的算法，但是节点的hash值是不均匀的，所以会导致数据偏移的问题。为了解决这个问题，一致性hash算法引入了虚拟节点的概念，一个物理节点对应多个虚拟节点，这样就可以解决数据偏移的问题，万物皆可虚拟化:cool:。

### 分布式锁:lock:
最常见的就是基于redis的分布式锁，通过setnx命令来实现分布式锁。     
也有基于etcd的分布式锁，通过etcd的事务来实现分布式锁。    
一定要注意分布式锁的超时时间，不然会导致死锁的问题。

### 分布式数据交互/选举
#### 强一致性
Raft
#### 最终一致性
GoSSIP    
go库 [memberlist](https://github.com/hashicorp/memberlist)

## 参考资料
- [7分钟了解一致性hash](https://www.bilibili.com/video/BV1Hs411j73w/?share_source=copy_web&vd_source=4f1eadc12650634cadac4c02b1cc4bf9)
- [etcd实现分布式锁](https://cloud.tencent.com/developer/article/2007164)